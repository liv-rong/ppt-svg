# 在线 PPT 编辑器技术方案

## 0. 前置步骤：Markdown 数据生成 PPT

### 功能说明

- 用户输入 Markdown 格式内容（如大纲、正文、分级标题等）。
- 系统解析 Markdown，自动生成 PPT 页面结构和内容。
- 用户可选择 PPT 模板（如不同配色、版式、字体等）。
- 系统根据模板和解析内容自动生成 PPT 文件。
- 用户可进入编辑器进行二次编辑和美化。

### 技术选型

- Markdown 解析：使用 marked、remark、markdown-it 等库将 Markdown 转为结构化数据。
- 模板引擎：自定义模板配置，支持不同风格和布局。
- PPT 生成：结合 SVG 渲染和页面结构，自动生成初步 PPT。
- 与编辑器无缝衔接，支持后续所有编辑功能。

### 相关模块设计

- 新增 markdown/ 目录，负责 Markdown 解析与模板应用。
- 新增模板管理模块，支持模板选择与预览。
- 编辑器主流程增加“导入 Markdown”入口。

### 流程示意

1. 用户输入 Markdown →
2. 解析生成页面结构 →
3. 用户选择模板 →
4. 自动生成 PPT →
5. 进入编辑器继续编辑

## 一、技术选型

- **前端框架**：Next.js（基于 React，支持服务端渲染与静态导出，便于后期扩展）
- **SVG 渲染**：原生 SVG + React 组件封装
- **状态管理**：Redux Toolkit 或 Zustand（用于全局状态管理，如元素、页面、撤销重做等）
- **样式方案**：Tailwind CSS 或 styled-components（快速开发与主题切换）
- **富文本编辑**：Draft.js、Slate.js 或自定义轻量文本编辑器
- **文件导出**：jsPDF（PDF 导出）、html-to-image/svg-to-img（图片导出）、原生 SVG 导出
- **持久化存储**：localStorage（本地自动保存）、可扩展为后端 API
- **辅助库**：Lodash、classnames、Hotkeys.js（快捷键支持）

## 二、项目目录结构设计

```plaintext
ppt-svg/
├── docs/                # 项目文档
│   ├── 需求文档.md
│   └── 技术方案.md
├── public/              # 静态资源
├── src/
│   ├── components/      # 通用组件（按钮、弹窗、工具栏等）
│   ├── features/        # 业务模块（PPT编辑、页面管理、元素操作等）
│   │   ├── editor/      # 编辑器主模块
│   │   ├── slide/       # 幻灯片页面管理
│   │   ├── element/     # 元素（文本、图形、图片等）管理
│   │   ├── export/      # 导出相关功能
│   │   └── markdown/    # Markdown 解析与模板应用
│   ├── hooks/           # 自定义 React Hooks
│   ├── store/           # 状态管理（Redux/Zustand）
│   ├── utils/           # 工具函数
│   ├── styles/          # 全局样式
│   ├── pages/           # Next.js 路由页面（如首页、编辑页、预览页等）
│   └── app/             # Next.js App Router（如采用新版目录结构）
├── .env                 # 环境变量配置
├── package.json         # 项目依赖
└── README.md            # 项目说明
```

## 三、核心模块划分

1. **前置模块（markdown+模板）**

   - Markdown 数据解析与页面结构生成
   - 模板选择与应用
   - 自动生成初步 PPT 文件

2. **编辑器主模块（editor）**

   - SVG 画布渲染与交互
   - 元素选中、拖拽、缩放、旋转
   - 对齐线、吸附、标尺等辅助功能

3. **元素管理模块（element）**

   - 文本、图形、图片等元素的增删改查
   - 属性面板（样式、层级、动画等）
   - 元素分组与多选

4. **页面管理模块（slide）**

   - 幻灯片的增删、复制、排序
   - 页面缩略图预览
   - 支持自动生成页面

5. **导出模块（export）**

   - 导出为 PDF、图片、SVG、PPTX
   - 导入/导出 PPT 文件（JSON 格式、Markdown 数据）

6. **撤销重做与快捷键支持**

   - 操作历史栈管理
   - 常用快捷键绑定

7. **持久化与数据存储**
   - 本地自动保存
   - 后端 API 扩展接口（可选）

## 四、关键技术点说明

- **SVG 编辑与渲染**：所有 PPT 元素均以 SVG 形式渲染，支持高精度缩放与导出。
- **富文本编辑**：文本元素采用富文本编辑器内嵌，支持多样式混排。
- **响应式设计**：编辑器界面自适应不同屏幕尺寸。
- **性能优化**：虚拟化渲染、按需加载、批量操作优化。
- **可扩展性**：各模块解耦，便于后续功能扩展（如动画、协作等）。

## 四、PPT 导出方案

### 1. SVG 导出

- 直接将当前编辑的 SVG 画布内容序列化为 SVG 文件，支持高保真矢量导出。
- 可通过 `Blob` 或 `data:` URL 方式下载。

### 2. 图片导出

- 利用 `html-to-image`、`svg-to-img` 等库，将 SVG 画布渲染为 PNG/JPEG 等位图格式。
- 支持单页导出，也可批量导出所有幻灯片为图片。
- 可选用 `canvas` 进行二次渲染，提升兼容性。

### 3. PDF 导出

- 结合 `jsPDF`、`pdf-lib` 等库，将每一页 SVG 或图片插入 PDF 文档，实现多页导出。
- 支持自定义页面尺寸、分辨率、边距等参数。
- 可支持批量导出全部幻灯片为单一 PDF 文件。

### 4. 批量导出与多格式支持

- 支持用户选择导出范围（单页/多页/全部）。
- 支持多种格式（SVG、PNG、JPEG、PDF、PPTX）灵活切换。
- 导出过程可提供进度提示与错误处理。

### 5. 扩展性

- 后续可支持 PPTX、ODP 等格式的导出，需引入专用解析/生成库。

## 五、后续扩展建议

- 用户系统与云端存储
- 多人协作与实时编辑
- 动画与过渡效果支持
- 模板与素材库

---

如需进一步细化某一模块或技术点，请补充说明。
